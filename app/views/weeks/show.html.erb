<div>
  <div class="text-center">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <h3><%= @week.beginning.to_date.to_s(:db) %>&mdash;<%= @week.end.to_date.to_s(:db) %> </h3>
      </div>
    </div>
    <div class="row">
      <div class="col-md-2 col-md-offset-3">
        <%= link_to show_week_path(@week.previous.ymd_hash) do %>
          <div class="btn btn-default">Previous week</div>
        <% end %>
      </div>
      <div class="col-md-2">
        <% if @week.beginning != Week.now.beginning %>
          <%= link_to current_week_path do %>
            <div class="btn btn-default btn-primary">This Week</div>
          <% end %>
        <% end %>
      </div>
      <div class="col-md-2">
        <%= link_to show_week_path(@week.next.ymd_hash) do %>
          <div class="btn btn-default">Next week</div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="timesheet-form">
    <%= form_for @timesheet, :html => { :role => "form" } do |f| %>
      <%= f.hidden_field :id, :value => @timesheet.id %>

      <% if (project_options = grouped_options_for_clients_and_projects_for(@timesheet)).present? %>
        <div class="row">
          <div class="form-group col-md-4 col-md-offset-8 text-right add-project">
            <%= f.select :projects, project_options, {}, {:class => "form-control input-sm"} %>
            <%= f.button "Add Project", :value => :add_project, :class => "btn btn-default btn-info btn-sm" %>
          </div>
        </div>
      <% end %>

      <div class="table-responsive">
        <table class="table table-hover table-striped table-condensed">
          <thead>
            <th>Project</th>
            <th>Su</th>
            <th>M</th>
            <th>Tu</th>
            <th>W</th>
            <th>Th</th>
            <th>F</th>
            <th>Sa</th>
            <th>Delete</th>
          </thead>
          <tbody>
            <%= f.fields_for :projects, @timesheet.projects do |project_fields| %>
              <tr>
                <td>
                  <p>
                    <strong><%= project_fields.object.name %></strong><br/>
                    <small><i><%= project_fields.object.client.name %></i></small>
                  </p>
                </td>
                <%= f.fields_for :entries, @timesheet.entries_for(project_fields.object) do |entry_fields| %>
                  <td>
                    <div class="form-group form-group-sm">
                      <%= entry_fields.select :presence, Entry.presences.keys, {}, {:class => "presence-select form-control input-sm"} %>
                      <%= entry_fields.text_field :hours, :size => 1, :class => "hours form-control input-sm #{'hidden' unless entry_fields.object.hourly?}" %>
                    </div>
                  </td>
                <% end %>
                <td>
                  <%= project_fields.check_box :_destroy %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="form-group">
        <%= f.label :notes %>
        <%= f.text_area :notes, :class => "form-control" %>
      </div>

      <%= f.submit :class => "btn btn-default" %>
    <% end %>
  </div>
</div>
